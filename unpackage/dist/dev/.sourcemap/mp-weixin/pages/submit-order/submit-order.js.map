{"version":3,"sources":["uni-app:///main.js","webpack:///C:/Users/86158/Desktop/PM/mall4uni/pages/submit-order/submit-order.vue?c694","webpack:///C:/Users/86158/Desktop/PM/mall4uni/pages/submit-order/submit-order.vue?5178","webpack:///C:/Users/86158/Desktop/PM/mall4uni/pages/submit-order/submit-order.vue?6add","webpack:///C:/Users/86158/Desktop/PM/mall4uni/pages/submit-order/submit-order.vue?1d20","uni-app:///pages/submit-order/submit-order.vue","webpack:///C:/Users/86158/Desktop/PM/mall4uni/pages/submit-order/submit-order.vue?7f94","webpack:///C:/Users/86158/Desktop/PM/mall4uni/pages/submit-order/submit-order.vue?fca5","webpack:///C:/Users/86158/Desktop/PM/mall4uni/wxs/number.wxs?6a9b","webpack:///C:/Users/86158/Desktop/PM/mall4uni/wxs/number.wxs?61c4"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","popupShow","couponSts","couponList","orderEntry","userAddr","orderItems","coupon","totalLength","canUseCoupons","noCanUseCoupons","actualTotal","total","totalCount","transfee","reduceAmount","remarks","couponIds","coupons","shopReduce","item","selAddress","components","props","onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh","onReachBottom","onShareAppMessage","methods","loadOrderData","addrId","uni","mask","url","method","orderItem","basketIds","userChangeCoupon","callBack","res","unCanUseCoupons","errCallBack","http","chooseCouponErrHandle","title","icon","duration","success","setTimeout","toPay","submitOrder","orderShopParam","shopId","console","normalPay","orderNumbers","calWeixinPay","payType","timeStamp","nonceStr","package","signType","paySign","fail","changeCouponSts","showCouponPopup","closePopup","toAddrListPage","choosedCoupon","checkCoupon","ths"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,oBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAqT;AACrT;AACgE;AACL;AACa;;;AAGxE;AAC4K;AAC5K,gBAAgB,qLAAU;AAC1B,EAAE,kFAAM;AACR,EAAE,mRAAM;AACR,EAAE,4RAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,uRAAU;AACZ;AACA;;AAEA;AAC0M;AAC1M,WAAW,wNAAM,iBAAiB,gOAAM;;AAExC;AACe,gF;;;;;;;;;;;;AC3Bf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,4KAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AChDA;AAAA;AAAA;AAAA;AAAyoB,CAAgB,8pBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACuL7pB;AACA,WAAW,mBAAO,CAAC,6BAAqB;AAAxC;EAAA;IAAA;EAAA;AAAA;AAAA,eAGA;EACAC;IACA;MACAC;MACAC;MACAC;MACA;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EAEAC;IACAf;EACA;EACAgB;EAEA;AACA;AACA;EACAC;IACA;MACApB;IACA;EACA;EAEA;AACA;AACA;EACAqB;EAEA;AACA;AACA;EACAC;IACA;IACA;IACA;MACA;MACA;IACA;;IAEA;IACA;EACA;EAEA;AACA;AACA;EACAC;EAEA;AACA;AACA;EACAC;EAEA;AACA;AACA;EACAC;EAEA;AACA;AACA;EACAC;EAEA;AACA;AACA;EACAC;EACAC;IACA;IACAC;MAAA;MACA;MAEA;QACAC;MACA;MAEAC;QACAC;MACA;MACA;QACAC;QACAC;QACAtC;UACAkC;UACAK;UACAC;UACAvB;UACAwB;QACA;QACAC;UACAP;UACA;UACAQ;YACArC;UACA;UAEA;YACA;YACA;YACAqC;cACA;gBACAlC;cACA;gBACAmC;cACA;YACA;YACA;cACA1B;gBACAV;gBACAC;gBACAmC;cACA;YACA;UACA;UAEA;YACAtC;YACAK;YACAC;YACAC;YACAR;YACAS;YACAK;UACA;QACA;QACA0B;UACAV;UACA;QACA;MACA;MACAW;IACA;IAEA;AACA;AACA;IACAC;MAAA;MACA;MACA;QACAZ;UACAa;UACAC;UACAC;UACAC;YACA;cACAlC;YACA;UACA;QACA;QACAmC;UACA;QACA;MACA;IACA;IAEA;AACA;AACA;IACAC;MACA;QACAlB;UACAa;UACAC;QACA;QACA;MACA;MAEA;IACA;IACAK;MAAA;MACAnB;QACAC;MACA;MACA;QACAC;QACAC;QACAtC;UACAuD;YACAvC;YACAwC;UACA;QACA;QACAd;UACAe;UACAtB;UACA;UACA;QAEA;MACA;MACAW;IACA;IAEA;IACAY;MACAvB;QACAC;MACA;MACA;QACAC;QACAC;QACAtC;UACA2D;QACA;QACAjB;UACAe;UACAtB;UACA;YACAA;cACAa;cACAC;YACA;YACAG;cACAjB;gBACAE;cACA;YACA;UACA;YACAF;cACAa;cACAC;YACA;UACA;QACA;MACA;MACAH;IACA;IAEA;AACA;AACA;IACAc;MACAzB;QACAC;MACA;MACA;QACAC;QACAC;QACAtC;UACA6D;UACAF;QACA;QACAjB;UAAA;UACAP;UACAA;YACA2B;YACAC;YACAC;YACAC;YACAC;YACAf;cACA;cACAhB;gBACAE;cACA;YACA;YACA8B;cACAhC;gBACAE;cACA;YACA;UACA;QACA;MACA;MACAS;IACA;IACAsB;MACA;QACAlE;MACA;IACA;IACAmE;MACA;QACApE;MACA;IACA;IACAqE;MACA;QACArE;MACA;IACA;IAEA;AACA;AACA;IACAsE;MACApC;QACAE;MACA;IACA;IAEA;AACA;AACA;IACAmC;MACA;MACA;QACAvE;MACA;IACA;IAEA;AACA;AACA;IACAwE;MACA;MACA;MAEA;QACAC;MACA;QACAA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC1gBA;AAAA;AAAA;AAAA;AAAy6B,CAAgB,m6BAAG,EAAC,C;;;;;;;;;;;ACA77B;AACA,OAAO,KAAU,EAAE,kBAKd;;;;;;;;;;;;;ACNL;AAAA;AAAA,wCAAwU,CAAgB,6YAAG,EAAC,C;;;;;;;;;;;;ACA5V;AAAe;AACf;AACA;AACA;;AAEA,M","file":"pages/submit-order/submit-order.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/submit-order/submit-order.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./submit-order.vue?vue&type=template&id=c955beb4&filter-modules=eyJ3eHMiOnsidHlwZSI6InNjcmlwdCIsImNvbnRlbnQiOiIiLCJzdGFydCI6NjcwMSwiYXR0cnMiOnsibW9kdWxlIjoid3hzIiwibGFuZyI6Ind4cyIsInNyYyI6Ii4uLy4uL3d4cy9udW1iZXIud3hzIn0sImVuZCI6NjcwMX19&\"\nvar renderjs\nimport script from \"./submit-order.vue?vue&type=script&lang=js&\"\nexport * from \"./submit-order.vue?vue&type=script&lang=js&\"\nimport style0 from \"./submit-order.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\n/* custom blocks */\nimport block0 from \"../../wxs/number.wxs?vue&type=custom&index=0&blockType=script&issuerPath=C%3A%5CUsers%5C86158%5CDesktop%5CPM%5Cmall4uni%5Cpages%5Csubmit-order%5Csubmit-order.vue&module=wxs&lang=wxs\"\nif (typeof block0 === 'function') block0(component)\n\ncomponent.options.__file = \"pages/submit-order/submit-order.vue\"\nexport default component.exports","export * from \"-!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./submit-order.vue?vue&type=template&id=c955beb4&filter-modules=eyJ3eHMiOnsidHlwZSI6InNjcmlwdCIsImNvbnRlbnQiOiIiLCJzdGFydCI6NjcwMSwiYXR0cnMiOnsibW9kdWxlIjoid3hzIiwibGFuZyI6Ind4cyIsInNyYyI6Ii4uLy4uL3d4cy9udW1iZXIud3hzIn0sImVuZCI6NjcwMX19&\"","var components\ntry {\n  components = {\n    coupon: function () {\n      return import(\n        /* webpackChunkName: \"components/coupon/coupon\" */ \"@/components/coupon/coupon.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.popupShow ? _vm.coupons.canUseCoupons.length : null\n  var g1 = _vm.popupShow && g0 ? _vm.coupons.canUseCoupons.length : null\n  var g2 = _vm.popupShow ? _vm.coupons.unCanUseCoupons.length : null\n  var g3 = _vm.popupShow && g2 ? _vm.coupons.unCanUseCoupons.length : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        g2: g2,\n        g3: g3,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./submit-order.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./submit-order.vue?vue&type=script&lang=js&\"","<template>\n<view>\n<!--pages/submit-order/submit-order.wxml-->\n<view class=\"container\">\n  <view class=\"submit-order\">\n    <!-- 收货地址 -->\n    <view class=\"delivery-addr \" @tap=\"toAddrListPage\">\n      <view class=\"addr-bg \" v-if=\"!userAddr\">\n        <view class=\"add-addr\">\n          <view class=\"plus-sign-img\">\n            <image src=\"/static/images/icon/plus-sign.png\"></image>\n          </view>\n          <text>新增收货地址</text>\n        </view>\n        <view class=\"arrow empty\"></view>\n      </view>\n      <view class=\"addr-bg whole\" v-if=\"userAddr\">\n        <view class=\"addr-icon\">\n          <image src=\"/static/images/icon/addr.png\"></image>\n        </view>\n        <view class=\"user-info\">\n          <text class=\"item\">{{userAddr.receiver}}</text>\n          <text class=\"item\">{{userAddr.mobile}}</text>\n        </view>\n        <view class=\"addr\">{{userAddr.province}}{{userAddr.city}}{{userAddr.area}}{{userAddr.addr}}</view>\n        <view class=\"arrow\"></view>\n      </view>\n    </view>\n\n    <!-- 商品详情 -->\n    <view class=\"prod-item\">\n      <block v-for=\"(item, index) in orderItems\" :key=\"index\">\n        <view class=\"item-cont\" @tap=\"toOrderDetailPage\" :data-ordernum=\"item.primaryOrderNo\">\n          <view class=\"prod-pic\">\n            <image :src=\"item.pic\"></image>\n          </view>\n          <view class=\"prod-info\">\n            <view class=\"prodname\">\n              {{item.prodName}}\n            </view>\n            <view class=\"prod-info-cont\">{{item.skuName}}</view>\n            <view class=\"price-nums\">\n              <text class=\"prodprice\"><text class=\"symbol\">￥</text>\n              <text class=\"big-num\">{{wxs.parsePrice(item.price)[0]}}</text>\n              <text class=\"small-num\">.{{wxs.parsePrice(item.price)[1]}}</text></text>\n              <text class=\"prodcount\">x{{item.prodCount}}</text>\n            </view>\n          </view>\n        </view>\n      </block>\n      <!-- <view class='item-cont' bindtap='toOrderDetailPage' data-ordernum=\"{{item.primaryOrderNo}}\">\n        <view class='prod-pic'>\n          <image src='../../images/prod/pic09.jpg'></image>\n        </view>\n        <view class='prod-info'>\n          <view class='prodname'>\n            THE BEAST/野兽派 易烊千玺同款\n          </view>\n          <view class='prod-info-cont'>经典杯型升级，杯型更细长优雅</view>\n          <view class='price-nums'>\n            <text class='prodprice'><text class='symbol'>￥</text>\n            <text class='big-num'>{{wxs.parsePrice(40.00)[0]}}</text>\n            <text class='small-num'>.{{wxs.parsePrice(40.00)[1]}}</text></text>\n            <text class=\"prodcount\">x1</text>\n          </view>\n        </view>\n      </view> -->\n\n      <view class=\"total-num\">\n        <text class=\"prodcount\">共{{totalCount}}件商品</text>\n        <view class=\"prodprice\">合计：\n          <text class=\"symbol\">￥</text>\n          <text class=\"big-num\">{{wxs.parsePrice(total)[0]}}</text>\n          <text class=\"small-num\">.{{wxs.parsePrice(total)[1]}}</text>\n        </view>\n      </view>\n    </view>\n\n    <!-- 订单详情 -->\n    <view class=\"order-msg\">\n      <view class=\"msg-item\">\n        <view class=\"item coupon\" @tap=\"showCouponPopup\">\n          <text class=\"item-tit\">优惠券：</text>\n          <text class=\"item-txt\" v-if=\"!coupons.canUseCoupons\">暂无可用</text>\n          <text class=\"coupon-btn\">{{coupons.totalLength? coupons.totalLength: 0}}张</text>\n          <text class=\"arrow\"></text>\n        </view>\n        <view class=\"item\">\n          <text>买家留言：</text>\n          <input v-model=\"remarks\" placeholder=\"给卖家留言\" />\n        </view>\n      </view>\n\n    </view>\n\n    <view class=\"order-msg\">\n      <view class=\"msg-item\">\n        <view class=\"item\">\n          <view class=\"item-tit\">订单总额：</view>\n          <view class=\"item-txt price\">\n            <text class=\"symbol\">￥</text>\n            <text class=\"big-num\">{{wxs.parsePrice(total)[0]}}</text>\n            <text class=\"small-num\">.{{wxs.parsePrice(total)[1]}}</text>\n          </view>\n        </view>\n        <view class=\"item\">\n          <view class=\"item-tit\">运费：</view>\n          <view class=\"item-txt price\">\n            <text class=\"symbol\">￥</text>\n            <text class=\"big-num\">{{wxs.parsePrice(transfee)[0]}}</text>\n            <text class=\"small-num\">.{{wxs.parsePrice(transfee)[1]}}</text>\n          </view>\n        </view>\n        <view class=\"item\">\n          <view class=\"item-tit\">优惠金额：</view>\n          <view class=\"item-txt price\">\n            <text class=\"symbol\">-￥</text>\n            <text class=\"big-num\">{{wxs.parsePrice(shopReduce)[0]}}</text>\n            <text class=\"small-num\">.{{wxs.parsePrice(shopReduce)[1]}}</text>\n          </view>\n        </view>\n        <view class=\"item payment\">\n          <view class=\"item-txt price\">\n            小计：\n            <text class=\"symbol\">￥</text>\n            <text class=\"big-num\">{{wxs.parsePrice(actualTotal)[0]}}</text>\n            <text class=\"small-num\">.{{wxs.parsePrice(actualTotal)[1]}}</text>\n          </view>\n        </view>\n      </view>\n    </view>\n  </view>\n\n\n  <!-- 底部栏 -->\n  <view class=\"submit-order-footer\">\n    <view class=\"sub-order\">\n      <view class=\"item-txt\">\n        合计：\n        <view class=\"price\">\n          <text class=\"symbol\">￥</text>\n          <text class=\"big-num\">{{wxs.parsePrice(actualTotal)[0]}}</text>\n          <text class=\"small-num\">.{{wxs.parsePrice(actualTotal)[1]}}</text>\n        </view>\n      </view>\n    </view>\n    <view class=\"footer-box\" @tap=\"toPay\">\n      提交订单\n    </view>\n  </view>\n</view>\n\n<!-- 选择优惠券弹窗 -->\n<view class=\"popup-hide\" v-if=\"popupShow\">\n  <view class=\"popup-box\">\n    <view class=\"popup-tit\">\n      <text>优惠券</text>\n      <text class=\"close\" @tap=\"closePopup\"></text>\n    </view>\n    <view class=\"coupon-tabs\">\n      <view :class=\"'coupon-tab ' + (couponSts==1?'on':'')\" @tap=\"changeCouponSts\" data-sts=\"1\">可用优惠券({{coupons.canUseCoupons.length?coupons.canUseCoupons.length:0}})</view>\n      <view :class=\"'coupon-tab ' + (couponSts==2?'on':'')\" @tap=\"changeCouponSts\" data-sts=\"2\">不可用优惠券({{coupons.unCanUseCoupons.length?coupons.unCanUseCoupons.length:0}})</view>\n    </view>\n    <view class=\"popup-cnt\">\n      <block v-for=\"(item, index) in coupons.canUseCoupons\" :key=\"index\" v-if=\"couponSts == 1\">\n        <coupon :item=\"item\" order=\"true\" @checkCoupon=\"checkCoupon\" canUse=\"true\"></coupon>\n      </block>\n      <block v-for=\"(item, index) in coupons.unCanUseCoupons\" :key=\"index\" v-if=\"couponSts == 2\">\n        <coupon :item=\"item\" order=\"true\" canUse=\"false\"></coupon>\n      </block>\n      <view class=\"botm-empty\"></view>\n    </view>\n    <view class=\"coupon-ok\" v-if=\"couponSts==1\">\n      <text @tap=\"choosedCoupon\">确定</text>\n    </view>\n  </view>\n</view>\n</view>\n</template>\n\n<script module=\"wxs\" lang=\"wxs\" src=\"../../wxs/number.wxs\"></script>\n\n<script>\n// pages/submit-order/submit-order.js\nvar http = require(\"../../utils/http.js\");\nimport coupon from \"../../components/coupon/coupon\";\n\nexport default {\n  data() {\n    return {\n      popupShow: false,\n      couponSts: 1,\n      couponList: [],\n      // 订单入口 0购物车 1立即购买\n      orderEntry: \"0\",\n      userAddr: null,\n      orderItems: [],\n      coupon: {\n        totalLength: 0,\n        canUseCoupons: [],\n        noCanUseCoupons: []\n      },\n      actualTotal: 0,\n      total: 0,\n      totalCount: 0,\n      transfee: 0,\n      reduceAmount: 0,\n      remarks: \"\",\n      couponIds: [],\n      coupons: {},\n      shopReduce: \"\",\n      item: {},\n      selAddress: ''\n    };\n  },\n\n  components: {\n    coupon\n  },\n  props: {},\n\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad: function (options) {\n    this.setData({\n      orderEntry: options.orderEntry\n    });\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady: function () {},\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow: function () {\n    var pages = getCurrentPages();\n    var currPage = pages[pages.length - 1];\n    if (currPage.selAddress == \"yes\") {\n      //将携带的参数赋值\n      this.userAddr = currPage.item\n    }\n\n    //获取订单数据\n    this.loadOrderData();\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide: function () {},\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload: function () {},\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh: function () {},\n\n  /**\n   * 页面上拉触底事件的处理函数\n   */\n  onReachBottom: function () {},\n\n  /**\n   * 用户点击右上角分享\n   */\n  onShareAppMessage: function () {},\n  methods: {\n    //加载订单数据\n    loadOrderData: function () {\n      var addrId = 0;\n\n      if (this.userAddr != null) {\n        addrId = this.userAddr.addrId;\n      }\n\n      uni.showLoading({\n        mask: true\n      });\n      var params = {\n        url: \"/p/order/confirm\",\n        method: \"POST\",\n        data: {\n          addrId: addrId,\n          orderItem: this.orderEntry === \"1\" ? JSON.parse(uni.getStorageSync(\"orderItem\")) : undefined,\n          basketIds: this.orderEntry === \"0\" ? JSON.parse(uni.getStorageSync(\"basketIds\")) : undefined,\n          couponIds: this.couponIds,\n          userChangeCoupon: 1\n        },\n        callBack: res => {\n          uni.hideLoading();\n          let orderItems = [];\n          res.shopCartOrders[0].shopCartItemDiscounts.forEach(itemDiscount => {\n            orderItems = orderItems.concat(itemDiscount.shopCartItems);\n          });\n\n          if (res.shopCartOrders[0].coupons) {\n            let canUseCoupons = [];\n            let unCanUseCoupons = [];\n            res.shopCartOrders[0].coupons.forEach(coupon => {\n              if (coupon.canUse) {\n                canUseCoupons.push(coupon);\n              } else {\n                unCanUseCoupons.push(coupon);\n              }\n            });\n            this.setData({\n              coupons: {\n                totalLength: res.shopCartOrders[0].coupons.length,\n                canUseCoupons: canUseCoupons,\n                unCanUseCoupons: unCanUseCoupons\n              }\n            });\n          }\n\n          this.setData({\n            orderItems: orderItems,\n            actualTotal: res.actualTotal,\n            total: res.total,\n            totalCount: res.totalCount,\n            userAddr: res.userAddr,\n            transfee: res.shopCartOrders[0].transfee,\n            shopReduce: res.shopCartOrders[0].shopReduce\n          });\n        },\n        errCallBack: res => {\n          uni.hideLoading();\n          this.chooseCouponErrHandle(res);\n        }\n      };\n      http.request(params);\n    },\n\n    /**\n     * 优惠券选择出错处理方法\n     */\n    chooseCouponErrHandle(res) {\n      // 优惠券不能共用处理方法\n      if (res.statusCode == 601) {\n        uni.showToast({\n          title: res.data,\n          icon: \"none\",\n          duration: 3000,\n          success: res => {\n            this.setData({\n              couponIds: []\n            });\n          }\n        });\n        setTimeout(() => {\n          this.loadOrderData();\n        }, 2500);\n      }\n    },\n\n    /**\n     * 提交订单\n     */\n    toPay: function () {\n      if (!this.userAddr) {\n        uni.showToast({\n          title: '请选择地址',\n          icon: \"none\"\n        });\n        return;\n      }\n\n      this.submitOrder();\n    },\n    submitOrder: function () {\n      uni.showLoading({\n        mask: true\n      });\n      var params = {\n        url: \"/p/order/submit\",\n        method: \"POST\",\n        data: {\n          orderShopParam: [{\n            remarks: this.remarks,\n            shopId: 1\n          }]\n        },\n        callBack: res => {\n\t\t\t\t\tconsole.log(\"res\",res)\n          uni.hideLoading();\n          // this.calWeixinPay(res.orderNumbers);\n\t\t\t\t\tthis.normalPay(res.orderNumbers)\n\t\t\t\t\t\n        }\n      };\n      http.request(params);\n    },\n\t\t\n\t\t//模拟支付，直接提交成功\n\t\tnormalPay: function(orderNumbers){\n\t\t\tuni.showLoading({\n\t\t\t  mask: true\n\t\t\t});\n\t\t\tvar params = {\n\t\t\t  url: \"/p/order/normalPay\",\n\t\t\t  method: \"POST\",\n\t\t\t  data: {\n\t\t\t    orderNumbers: orderNumbers\n\t\t\t  },\n\t\t\t  callBack: res => {\n\t\t\t\t\tconsole.log(\"res\",res)\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\tif(res){\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: \"模拟支付成功\",\n\t\t\t\t\t\t\ticon:\"none\"\n\t\t\t\t\t\t})\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\t\t  url: '/pages/pay-result/pay-result?sts=1&orderNumbers=' + orderNumbers\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},1200)\n\t\t\t\t\t}else{\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: \"支付失败！\",\n\t\t\t\t\t\t\ticon:\"none\"\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t  }\n\t\t\t};\n\t\t\thttp.request(params);\n\t\t},\n\t\t\n    /**\n     * 唤起微信支付\n     */\n    calWeixinPay: function (orderNumbers) {\n      uni.showLoading({\n        mask: true\n      });\n      var params = {\n        url: \"/p/order/pay\",\n        method: \"POST\",\n        data: {\n          payType: 1,\n          orderNumbers: orderNumbers\n        },\n        callBack: function (res) {\n          uni.hideLoading();\n          uni.requestPayment({\n            timeStamp: res.timeStamp,\n            nonceStr: res.nonceStr,\n            package: res.packageValue,\n            signType: res.signType,\n            paySign: res.paySign,\n            success: e => {\n              // console.log(\"支付成功\");\n              uni.navigateTo({\n                url: '/pages/pay-result/pay-result?sts=1&orderNumbers=' + orderNumbers + \"&orderType=\" + this.orderType\n              });\n            },\n            fail: err => {\n              uni.navigateTo({\n                url: '/pages/pay-result/pay-result?sts=0&orderNumbers=' + orderNumbers + \"&orderType=\" + this.orderType\n              });\n            }\n          });\n        }\n      };\n      http.request(params);\n    },\n    changeCouponSts: function (e) {\n      this.setData({\n        couponSts: e.currentTarget.dataset.sts\n      });\n    },\n    showCouponPopup: function () {\n      this.setData({\n        popupShow: true\n      });\n    },\n    closePopup: function () {\n      this.setData({\n        popupShow: false\n      });\n    },\n\n    /**\n     * 去地址页面\n     */\n    toAddrListPage: function () {\n      uni.navigateTo({\n        url: '/pages/delivery-address/delivery-address?order=0'\n      });\n    },\n\n    /**\n     * 确定选择好的优惠券\n     */\n    choosedCoupon: function () {\n      this.loadOrderData();\n      this.setData({\n        popupShow: false\n      });\n    },\n\n    /**\n     * 优惠券子组件发过来\n     */\n    checkCoupon: function (e) {\n      var ths = this;\n      let index = ths.couponIds.indexOf(e.detail.couponId);\n\n      if (index === -1) {\n        ths.couponIds.push(e.detail.couponId);\n      } else {\n        ths.couponIds.splice(index, 1);\n      }\n    }\n  }\n};\n</script>\n<style>\n@import \"./submit-order.css\";\n</style>","import mod from \"-!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./submit-order.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./submit-order.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1684836603184\n      var cssReload = require(\"D:/tools/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  ","import mod from \"-!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-filter-loader\\\\index.js!./number.wxs?vue&type=custom&index=0&blockType=script&issuerPath=C%3A%5CUsers%5C86158%5CDesktop%5CPM%5Cmall4uni%5Cpages%5Csubmit-order%5Csubmit-order.vue&module=wxs&lang=wxs\"; export default mod; export * from \"-!D:\\\\tools\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-filter-loader\\\\index.js!./number.wxs?vue&type=custom&index=0&blockType=script&issuerPath=C%3A%5CUsers%5C86158%5CDesktop%5CPM%5Cmall4uni%5Cpages%5Csubmit-order%5Csubmit-order.vue&module=wxs&lang=wxs\"","export default function (Component) {\n       if(!Component.options.wxsCallMethods){\n         Component.options.wxsCallMethods = []\n       }\n       \n     }"],"sourceRoot":""}